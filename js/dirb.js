DIRB_LIST = []
STOP_FLAG = true
function readdirbpayload(){
    file = "./assets/dirbfull.txt"
    $.get(file,{},function(content){
	    DIRB_LIST =content.split('\n');
	});
}
function burpdir(url){
    base = $("#dirb_url").val()
    url = base + url
    var r = new XMLHttpRequest();
    r.timeout = 5000
    r.open("GET", url);
    r.onload = function()
    {
        console.log(r); 
        r_url = r.responseURL
        if (r.status >=200 && r.status<300){
            if (r_url[r_url.length-1] == "/"){
                dirbappendhtml(r_url,r.status,"dir",true)
            } else{
                dirbappendhtml(url,r.status,"file",true)
            }
        } else {
            dirbappendhtml(url,r.status,"404",false)

        }
        if (!STOP_FLAG){
            doonerequestandwait()

        }
    }
    r.send();
   /* $.ajax({
        type: "get",
        url: url,
        success: function (res) {
            console.log(res, textStatus, xhr)
            dirbappendhtml(url,xhr.status,"☑️ OK",true)
        },
        complete: function (xhr) {
            console.log(xhr)

            dirbappendhtml(url,xhr.status,"× Error",false)
        }
    })*/
}
function dirbappendhtml(url,status,msg,suss){
    var el = document.createElement("p"); 
    $(el).addClass("item cancopy")
    $(el).text(url)
    var state = document.createElement("i"); 
    $(state).addClass("ui basic label small")
    $(state).text(status)
    $(state).css("float","right")
    $(state).css("margin-right","10px")

    $(el).prepend(state)

    var icon = document.createElement("i"); 
    $(icon).addClass("icon small")
    $(icon).css("float","right")
    $(icon).css("margin-right","10px")

    if (suss){
        if (msg=="dir"){
            $(icon).addClass("folder open circular inverted green")
        } else {
            $(icon).addClass("file circular inverted green")
        }
        $(el).append(icon)
        $('#dirb_result').prepend(el);

    } else {
        $(el).append(icon)
        $(icon).addClass("window close circular inverted red")

        $('#dirb_result').append(el);

    }    
    $(".cancopy").off()
    $(".cancopy").click(function () {
        copyToClipboard($(this))
    })
    $(".folder").off()
    $(".folder").click(function(){
        $("#dirb_url").val($(this).parent().justtext())
    })

}
idx = 0
function doonerequestandwait(){
    if (idx<`${DIRB_LIST.length}`){
        burpdir(DIRB_LIST[idx])
        idx++
       // setTimeout(( () => doonerequestandwait() ), 200);
    }else{
        STOP_FLAG = true
        $('#dirb_go').text("Burp!")

    }
}
$(document).ready(function() {
    readdirbpayload()
    $("#dirb_url").val(NOW_URL.origin+"/")
    $('#dirb_go').click(function(){
        if ( $("#dirb_url").val().indexOf('http') === -1 ){
            $("#dirb_url").val("http://"+$("#dirb_url").val())
        }

        idx = 0


        if (!STOP_FLAG){
            STOP_FLAG = true
            $('#dirb_go').text("Burp!")
        } else {
            STOP_FLAG = false
            $('#dirb_result').empty();
            $('#dirb_go').text("Stop")
            doonerequestandwait()
        }

        
    })
    jQuery.fn.justtext = function() {

        return $(this).clone()
                .children()
                .remove()
                .end()
                .text();
    
    };
})
